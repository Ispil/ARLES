#Seeding Provinces with Base Resources
#Enacted through Isis' character history to make sure modifiers are set before D-Day

namespace = arles_base

#arles_base.0
#
#Initial randomisation event
character_event = {
	id = arles_base.0
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			NOT = { has_global_flag = genesis } #Start case
			any_independent_ruler = { # Recursive case
				has_character_flag = base_seed
			}
		}
	}
	
	immediate = {
		random_list = { #Advance random seed
			50 = { if = { limit = { always = yes } } } #Fool the engine
			50 = { }
		}
	}
	
	option = {
		name = OK
		if = {
			limit = { NOT = { has_global_flag = genesis } }
			set_global_flag = genesis
			save_event_target_as = verbum
			set_variable = { which = amber_gaia value = 0 }
			set_variable = { which = ivory_gaia value = 0 }
			set_variable = { which = gold_gaia value = 0 }
			any_independent_ruler = { # Setup recursion state
				set_character_flag = base_seed
			}
		}
		
		# Following the example set in emf.rr, we'll have to use recursive events rather than just
		# any_province.  For this event, we will recurse once for each independent ruler in the game
		# and seed their demesne provinces, then use similar strategies to handle their vassals' demesnes.
		
		if = {
			limit  = { has_global_flag = genesis }
			# Select a random independent realm to begin seeding
			random_independent_ruler = {
				limit = { has_character_flag = base_seed }
				character_event = { id = arles_base.1 } # Randomize realm
			}
		}
		
		repeat_event = { id = arles_base.0 } #Recurse
	}
}

# arles_base.1
#
# Randomize independent realm
#
# ROOT = independent ruler
# FROM = Isis
character_event = {
	id = arles_base.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			has_character_flag = base_seed #Start
			any_realm_lord = { #Recurse
				has_character_flag = seed_demesne
			}
		}
	}
	
	immediate = {
		random_list = { #Advance random seed
			50 = { if = { limit = { always = yes } } } #Fool the engine
			50 = { }
		}
	}
	
	option = {
		name = OK
		
		if = {
			limit = { has_character_flag = base_seed } #Start case
			clr_character_flag = base_seed
			
			# First, randomize the top liege's demesne
			set_character_flag = seed_demesne
			character_event = { id = arles_base.2 }
			
			# Set realm lords' demesnes which we will randomize. Limit at count-level to catch all
			# provinces, ideally.
			
			any_realm_lord = {
				limit = { higher_tier_than = baron }
				set_character_flag = seed_demesne
			}
		}
		
		if = {
			limit = { NOT = { has_character_flag = base_seed } } #Recursive case
			# Select a ruler and randomize his court
			random_realm_lord = {
				limit = { has_character_flag = seed_demesne }
				character_event = { id = arles_base.2 }
			}
		}
		
		# Recurse
		repeat_event = { id = arles_base.1 }
	}
}

# arles_base.2
#
# Recursion coherency unit
# ROOT = ruler
# FROM = top_liege
character_event = {
	id = arles_base.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = { #Advance random seed
			50 = { if = { limit = { always = yes } } } #Fool the engine
			50 = { }
		}
	}
	
	option = {
		name = OK
		
		if = {
			limit = { has_character_flag = seed_demesne } #Start case
			clr_character_flag = seed_demesne
			
			character_event = { id = arles_base.3 } # Randomize province
		}
	}
}

# arles_base.3
#
#Character to province conversion
character_event = {
	id = arles_base.3
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_demesne_province = {
			NOT = { has_province_flag = init_province_pop }
			NOT = { has_province_flag = dixitquedeus }
		} 
	}
	
	immediate = {
		random_list = { #Advance random seed
			50 = { if = { limit = { always = yes } } } #Fool the engine
			50 = { }
		}
	}
	
	option = {
		name = OK
		random_demesne_province = {
			limit = { NOT = { has_province_flag = init_province_pop } }
			save_event_target_as = home_province
			
			#BEGIN PROVINCE POPULATION MODIFIERS
			if = { 
				limit = { 
					event_target:home_province = { NOT = { has_province_flag = dixitquedeus } }
				}
				add_province_modifier = { name = arles_pop1 duration = -1 } #Population level 1
				set_variable = { which = province_pop value = 0 } #Province population level counter
				set_variable = { which = province_pop_diff value = 0 } #Aggregate Population level diff 
				set_variable = { which = province_pop_diff_terr value = 0 } #Population level diff (terrain component)
				set_variable = { which = province_pop_diff_trade value = 0 } #Population level diff (trade goods component)
				log = "DEBUG arles_pop.3 Successfully set up province defines in [This.GetName] ([This.GetID])"
				set_province_flag = init_province_pop
			}
		}
		character_event = { id = arles_base.4 } #Set up holdings
		
		character_event = { id = arles_base.5 } #Finish processing provincial level
		character_event = { id = arles_base.6 days = 365 } #Initiate pop growth pulse
				
		repeat_event = { id = arles_base.3 } #Recurse
	}
}

#Seeding holdings in provinces
character_event = {
	id = arles_base.4
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			event_target:home_province = { has_province_flag = init_province_pop } #start case
			event_target:home_province = { #recursive case
				any_province_holding = { NOT = { has_title_flag = holding_has_pop } }
			}
		}
	}
	
	immediate = {
		random_list = { #Advance random seed
			50 = { if = { limit = { always = yes } } } #Fool the engine
			50 = { }
		}
	}
	
	option = {
		name = "OK"
		event_target:home_province = {
			clr_province_flag = init_province_pop
			#BEGIN HOLDING POPULATION MODIFIERS
			random_province_holding = {
				limit = { NOT = { has_title_flag = holding_has_pop } }
				save_event_target_as = home_holding
				add_holding_modifier = { modifier = arles_holding_pop1 duration = -1 }
				set_variable = { which = holding_pop value = 0 }
				set_variable = { which = holding_pop_diff value = 0 }
				set_variable = { which = holding_pop_diff_terr value = 0 }
				set_variable = { which = holding_pop_diff_trade value = 0 }
				set_variable = { which = holding_pop_dmg value = 0 }
				set_title_flag = holding_has_pop
				log = "DEBUG: arles.base.4 Beginning processing of [This.GetName], Barony [This.GetID]"
				
				#BEGIN ADDING PRIMARY POPS IF NEEDED
				if = {
					limit = { 
						NOT = {
							has_building = ca_town_1
							has_building = ct_marketplace_1
							has_building = tp_town_1
							has_building = tb_market_town_1
						}
					}
					if = {
						limit = { holding_type = castle }
						add_building = ca_town_1
						log = "DEBUG arles_base.4 Successfully built new housing in castle"
					}
					if = {
						limit = { holding_type = city }
						add_building = ct_marketplace_1
						log = "DEBUG arles_base.4 Successfully built new housing in city"
					}
					if = {
						limit = { holding_type = temple }
						add_building = tp_town_1
						log = "DEBUG arles_base.4 Successfully built new housing in temple"
					}
					if = {
						limit = { holding_type = tribal }
						add_building = tb_market_town_1
						log = "DEBUG arles_base.4 Successfully built new housing in tribal village"
					}
				}
				
				#BEGIN TECH-POP CONVERSION STATE (CASTLES)
				#Level 2
				if = {
					limit = { holding_type = castle }
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.0 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_2
									}
								}
							}
							add_building = ca_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.2 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_2
									}
								}
							}
							add_building = ca_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.4 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_2
									}
								}
							}
							add_building = ca_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.6 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_2
									}
								}
							}
							add_building = ca_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.8 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_2
									}
								}
							}
							add_building = ca_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 3.0 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_2
									}
								}
							}
							add_building = ca_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in castle"
						}
					}
				}
				#Level 3
				if = {
					limit = { holding_type = castle }
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.2 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_3
									}
								}
							}
							add_building = ca_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.4 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_3
									}
								}
							}
							add_building = ca_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.6 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_3
									}
								}
							}
							add_building = ca_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 2.8 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_3
									}
								}
							}
							add_building = ca_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 3.0 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_3
									}
								}
							}
							add_building = ca_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 3.2 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_3
									}
								}
							}
							add_building = ca_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in castle"
						}
					}
				}
				#Level 4
				if = {
					limit = { holding_type = castle }
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 3.2 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_4
									}
								}
							}
							add_building = ca_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 3.4 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_4
									}
								}
							}
							add_building = ca_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 3.6 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_4
									}
								}
							}
							add_building = ca_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 3.8 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_4
									}
								}
							}
							add_building = ca_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 4.0 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_4
									}
								}
							}
							add_building = ca_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 4.2 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ca_town_4
									}
								}
							}
							add_building = ca_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in castle"
						}
					}
				}
				#Level 5
				if = {
					limit = { holding_type = castle }
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 5.2 }
						random = {
							chance = 2.5
							add_building = ca_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 5.4 }
						random = {
							chance = 2.5
							add_building = ca_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 5.6 }
						random = {
							chance = 2.5
							add_building = ca_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 5.8 }
						random = {
							chance = 2.5
							add_building = ca_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 6.0 }
						random = {
							chance = 2.5
							add_building = ca_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in castle"
						}
					}
					if = { 
						limit = { TECH_CASTLE_CONSTRUCTION = 6.2 }
						random = {
							chance = 2.5
							add_building = ca_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in castle"
						}
					}
				}
				
				#BEGIN TECH-POP CONVERSION STATE (CITIES)
				#Level 2
				if = {
					limit = { holding_type = city }
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 1.4 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_2
									}
								}
							}
							add_building = ct_marketplace_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 1.6 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_2
									}
								}
							}
							add_building = ct_marketplace_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 1.8 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_2
									}
								}
							}
							add_building = ct_marketplace_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.0 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_2
									}
								}
							}
							add_building = ct_marketplace_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.2 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_2
									}
								}
							}
							add_building = ct_marketplace_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.4 }
						random = {
							chance = 30
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_2
									}
								}
							}
							add_building = ct_marketplace_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in city"
						}
					}
				}
				#Level 3
				if = {
					limit = { holding_type = city }
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.2 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_3
									}
								}
							}
							add_building = ct_marketplace_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.4 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_3
									}
								}
							}
							add_building = ct_marketplace_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.6 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_3
									}
								}
							}
							add_building = ct_marketplace_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.8 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_3
									}
								}
							}
							add_building = ct_marketplace_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.0 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_3
									}
								}
							}
							add_building = ct_marketplace_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.2 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_3
									}
								}
							}
							add_building = ct_marketplace_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in city"
						}
					}
				}
				#Level 4
				if = {
					limit = { holding_type = city }
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.2 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_4
									}
								}
							}
							add_building = ct_marketplace_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.4 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_4
									}
								}
							}
							add_building = ct_marketplace_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.6 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_4
									}
								}
							}
							add_building = ct_marketplace_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.8 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_4
									}
								}
							}
							add_building = ct_marketplace_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 4.0 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_4
									}
								}
							}
							add_building = ct_marketplace_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 4.2 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.5
								any_neighbor_province = {
									any_province_holding = {
										has_building = ct_marketplace_4
									}
								}
							}
							add_building = ct_marketplace_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in city"
						}
					}
				}
				#Level 5
				if = {
					limit = { holding_type = city }
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 5.2 }
						random = {
							chance = 5
							add_building = ct_marketplace_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 5.4 }
						random = {
							chance = 5
							add_building = ct_marketplace_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 5.6 }
						random = {
							chance = 5
							add_building = ct_marketplace_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 5.8 }
						random = {
							chance = 5
							add_building = ct_marketplace_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 6.0 }
						random = {
							chance = 5
							add_building = ct_marketplace_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in city"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 6.2 }
						random = {
							chance = 5
							add_building = ct_marketplace_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in city"
						}
					}
				}
				
				#BEGIN TECH-POP CONVERSION (TEMPLES)
				#Level 2
				if = {
					limit = { holding_type = temple }
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 1.6 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_2
									}
								}
							}
							add_building = tp_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 1.8 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_2
									}
								}
							}
							add_building = tp_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 2.0 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_2
									}
								}
							}
							add_building = tp_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 2.2 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_2
									}
								}
							}
							add_building = tp_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 2.4 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_2
									}
								}
							}
							add_building = tp_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 2.6 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_2
									}
								}
							}
							add_building = tp_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in temple"
						}
					}
				}
				#Level 3
				if = {
					limit = { holding_type = temple }
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 2.2 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_3
									}
								}
							}
							add_building = tp_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 2.4 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_3
									}
								}
							}
							add_building = tp_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 2.6 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_3
									}
								}
							}
							add_building = tp_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 2.8 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_3
									}
								}
							}
							add_building = tp_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 3.0 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_3
									}
								}
							}
							add_building = tp_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 3.2 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_3
									}
								}
							}
							add_building = tp_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in temple"
						}
					}
				}
				#Level 4
				if = {
					limit = { holding_type = temple }
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 3.2 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.25
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_4
									}
								}
							}
							add_building = tp_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 3.4 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.25
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_4
									}
								}
							}
							add_building = tp_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 3.6 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.25
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_4
									}
								}
							}
							add_building = tp_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 3.8 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.25
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_4
									}
								}
							}
							add_building = tp_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 4.0 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.25
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_4
									}
								}
							}
							add_building = tp_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 4.2 }
						random = {
							chance = 7.5
							modifier = {
								factor = 1.25
								any_neighbor_province = {
									any_province_holding = {
										has_building = tp_town_4
									}
								}
							}
							add_building = tp_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in temple"
						}
					}
				}
				#Level 5
				if = {
					limit = { holding_type = temple }
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 5.2 }
						random = {
							chance = 2.5
							add_building = tp_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 5.4 }
						random = {
							chance = 2.5
							add_building = tp_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 5.6 }
						random = {
							chance = 2.5
							add_building = tp_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 5.8 }
						random = {
							chance = 2.5
							add_building = tp_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 6.0 }
						random = {
							chance = 2.5
							add_building = tp_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in temple"
						}
					}
					if = { 
						limit = { TECH_TEMPLE_CONSTRUCTION = 6.2 }
						random = {
							chance = 2.5
							add_building = tp_town_5
							log = "DEBUG arles_base.4 Successfully built level 5 housing in temple"
						}
					}
				}
				
				#BEGIN TECH-POP CONVERSION (TRIBES)
				#Level 2
				if = {
					limit = { holding_type = tribal }
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 1.5 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_2
									}
								}
							}
							add_building = tb_market_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 1.7 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_2
									}
								}
							}
							add_building = tb_market_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 1.9 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_2
									}
								}
							}
							add_building = tb_market_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.1 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_2
									}
								}
							}
							add_building = tb_market_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.3 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_2
									}
								}
							}
							add_building = tb_market_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 2.5 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_2
									}
								}
							}
							add_building = tb_market_town_2
							log = "DEBUG arles_base.4 Successfully built level 2 housing in tribe"
						}
					}
				}
				#Level 3
				if = {
					limit = { holding_type = tribal }
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.0 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_3
									}
								}
							}
							add_building = tb_market_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.2 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_3
									}
								}
							}
							add_building = tb_market_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.4 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_3
									}
								}
							}
							add_building = tb_market_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.6 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_3
									}
								}
							}
							add_building = tb_market_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.8 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_3
									}
								}
							}
							add_building = tb_market_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 4.0 }
						random = {
							chance = 20
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_3
									}
								}
							}
							add_building = tb_market_town_3
							log = "DEBUG arles_base.4 Successfully built level 3 housing in tribe"
						}
					}
				}
				#Level 4
				if = {
					limit = { holding_type = tribal }
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.5 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_4
									}
								}
							}
							add_building = tb_market_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.7 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_4
									}
								}
							}
							add_building = tb_market_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 3.9 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_4
									}
								}
							}
							add_building = tb_market_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 4.1 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_4
									}
								}
							}
							add_building = tb_market_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 4.3 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_4
									}
								}
							}
							add_building = tb_market_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in tribe"
						}
					}
					if = { 
						limit = { TECH_CITY_CONSTRUCTION = 4.5 }
						random = {
							chance = 15
							modifier = {
								factor = 2
								any_neighbor_province = {
									any_province_holding = {
										has_building = tb_market_town_4
									}
								}
							}
							add_building = tb_market_town_4
							log = "DEBUG arles_base.4 Successfully built level 4 housing in tribe"
						}
					}
				}

				#BEGIN HOLDING-POP CONVERSION (sliding scale with +50 differential per step up)
				if = { 
					limit = { has_building = tb_market_town_1 }
					change_variable = { which = holding_pop_diff value = 25 }
					change_variable = { which = holding_pop which = holding_pop_diff }
					set_variable = { which = holding_pop_diff value = 0 }
					location = {
						change_variable = { which = province_pop_diff value = 0.75 }
						change_variable = { which = province_pop which = province_pop_diff }
						set_variable = { which = province_pop_diff value = 0 }
					}
				}
				if = {
					limit = { 
						OR = {
							has_building = ca_town_1
							has_building = ct_marketplace_1
							has_building = tp_town_1
							has_building = tb_market_town_2
						}
					}
					change_variable = { which = holding_pop_diff value = 50 }
					change_variable = { which = holding_pop which = holding_pop_diff }
					set_variable = { which = holding_pop_diff value = 0 }
					location = {
						change_variable = { which = province_pop_diff value = 1.25 }
						change_variable = { which = province_pop which = province_pop_diff }
						set_variable = { which = province_pop_diff value = 0 }
					}
				}
				if = {
					limit = { 
						OR = {
							has_building = ca_town_2
							has_building = ct_marketplace_2
							has_building = tp_town_2
							has_building = tb_market_town_3
						}
					}
					change_variable = { which = holding_pop_diff value = 100 }
					change_variable = { which = holding_pop which = holding_pop_diff }
					set_variable = { which = holding_pop_diff value = 0 }
					location = {
						change_variable = { which = province_pop_diff value = 1.75 }
						change_variable = { which = province_pop which = province_pop_diff }
						set_variable = { which = province_pop_diff value = 0 }
					}
				}
				if = {
					limit = { 
						OR = {
							has_building = ca_town_3
							has_building = ct_marketplace_3
							has_building = tp_town_3
							has_building = tb_market_town_4
						}
					}
					change_variable = { which = holding_pop_diff value = 150 }
					change_variable = { which = holding_pop which = holding_pop_diff }
					set_variable = { which = holding_pop_diff value = 0 }
					location = {
						change_variable = { which = province_pop_diff value = 2.25 }
						change_variable = { which = province_pop which = province_pop_diff }
						set_variable = { which = province_pop_diff value = 0 }
					}
				}
				if = {
					limit = { 
						OR = {
							has_building = ca_town_4
							has_building = ct_marketplace_4
							has_building = tp_town_4
						}
					}
					change_variable = { which = holding_pop_diff value = 200 }
					change_variable = { which = holding_pop which = holding_pop_diff }
					set_variable = { which = holding_pop_diff value = 0 }
					location = {
						change_variable = { which = province_pop_diff value = 2.75 }
						change_variable = { which = province_pop which = province_pop_diff }
						set_variable = { which = province_pop_diff value = 0 }
					}
				}
				if = {
					limit = { 
						OR = {
							has_building = ca_town_5
							has_building = ct_marketplace_5
							has_building = tp_town_5
						}
					}
					change_variable = { which = holding_pop_diff value = 250 }
					change_variable = { which = holding_pop which = holding_pop_diff }
					set_variable = { which = holding_pop_diff value = 0 }
					location = {
						change_variable = { which = province_pop_diff value = 3.25 }
						change_variable = { which = province_pop which = province_pop_diff }
						set_variable = { which = province_pop_diff value = 0 }
					}
				}			
				if = {
					limit = { 
						OR = {
							has_building = ct_marketplace_6
							has_building = tp_town_6
						}
					}
					change_variable = { which = holding_pop_diff value = 300 }
					change_variable = { which = holding_pop which = holding_pop_diff }
					set_variable = { which = holding_pop_diff value = 0 }
					location = {
						change_variable = { which = province_pop_diff value = 3.75 }
						change_variable = { which = province_pop which = province_pop_diff }
						set_variable = { which = province_pop_diff value = 0 }
					}
				}
				log = "DEBUG arles_base.4 Successfully summed holding population to [This.holding_pop.GetValue] from all town buildings"
				if = {
					limit = {
						holder_scope = { is_nomadic = yes }
						NOT = { any_province_holding = { NOT = { holding_type = nomad } } }
					}
					set_variable = { which = holding_pop value = 0 }
					log = "DEBUG arles_base.4 Successfully zeroed holding population to [This.holding_pop.GetValue] for nomad camps"
				}
					
				#BEGIN TERRAIN POP GROWTH CONSTANTS
				location = {
					if = {
						limit = { terrain = mountain } #50% slower base pop growth in mountains
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.5 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = hills } #25% slower base pop growth in hills
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.25 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = forest } #20% slower base pop growth in forests
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.20 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = plains } #Standard of growth
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = farmlands } #5% faster base pop growth in farmland
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							multiply_variable = { which = holding_pop_diff_terr value = 1.05 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = steppe } #20% slower base pop growth in steppes, not as much arable land
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.20 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = desert } #35% slower base pop growth in desert
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.35 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = { 
						limit = { terrain = coastal_desert } #25% slower base pop growth in desert
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.25 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = arctic } #50% slower base pop growth in arctic
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.50 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = jungle } #35% slower base pop growth in jungle
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.35 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue] ([Prev.terrain.GetName])"
						}
					}
					if = {
						limit = { terrain = marsh } #25% slower base pop growth in marshland
						PREV = {
							set_variable = { which = holding_pop_diff_terr value = 1 }
							divide_variable = { which = holding_pop_diff_terr value = 1.25 }
							log = "DEBUG arles_base.4 Defined terrain modifier as [This.holding_pop_diff_terr.GetValue]"
						}
					}
				}
				#POPULATION - TERRAIN MODIFIERS
				multiply_variable = { which = holding_pop which = holding_pop_diff_terr }
				log = "DEBUG arles_base.4 Successfully summed holding population to [This.holding_pop.GetValue] after applying terrain modifiers"
				
				#BEGIN POPULATION LEVEL ASSIGNMENT
				#Advance to pop level 2
				if = { 
					limit = { 
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = temple
						}
						check_variable = { which = holding_pop value = 149.5 } 
					}
					remove_holding_modifier = arles_holding_pop1
					add_holding_modifier = { modifier = arles_holding_pop2 duration = -1 }
					set_title_flag = minor_pop
					log = "DEBUG arles_base.4 Changed civ holding modifier to Level 2 based on holding population of [This.holding_pop.GetValue]"
				}
				if = { 
					limit = { 
						holding_type = tribal
						check_variable = { which = holding_pop value = 74.5 } 
					}
					remove_holding_modifier = arles_holding_pop1
					add_holding_modifier = { modifier = arles_holding_pop2 duration = -1 }
					set_title_flag = clan_pop
					log = "DEBUG arles_base.4 Changed tribal holding modifier to Level 2 based on holding population of [This.holding_pop.GetValue]"
				}
				#Advance to pop level 3
				if = { 
					limit = { 
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = temple
						}
						check_variable = { which = holding_pop value = 299.5 } 
					}
					remove_holding_modifier = arles_holding_pop2
					add_holding_modifier = { modifier = arles_holding_pop3 duration = -1 }
					set_title_flag = burg_pop
					log = "DEBUG arles_base.4 Changed civ holding modifier to Level 3 based on holding population of [This.holding_pop.GetValue]"
				}
				if = { 
					limit = { 
						holding_type = tribal
						check_variable = { which = holding_pop value = 174.5 } 
					}
					remove_holding_modifier = arles_holding_pop2
					add_holding_modifier = { modifier = arles_holding_pop3 duration = -1 }
					set_title_flag = minor_pop
					log = "DEBUG arles_base.4 Changed tribal holding modifier to Level 3 based on holding population of [This.holding_pop.GetValue]"
				}
				#Advance to pop level 4
				if = { 
					limit = { 
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = temple
						}
						check_variable = { which = holding_pop value = 499.5 } 
					}
					remove_holding_modifier = arles_holding_pop3
					add_holding_modifier = { modifier = arles_holding_pop4 duration = -1 }
					set_title_flag = major_pop
					log = "DEBUG arles_base.4 Changed civ holding modifier to Level 4 based on holding population of [This.holding_pop.GetValue]"
				}
				if = { 
					limit = { 
						holding_type = tribal
						check_variable = { which = holding_pop value = 324.5 } 
					}
					remove_holding_modifier = arles_holding_pop3
					add_holding_modifier = { modifier = arles_holding_pop4 duration = -1 }
					set_title_flag = burg_pop
					log = "DEBUG arles_base.4 Changed tribal holding modifier to Level 4 based on holding population of [This.holding_pop.GetValue]"
				}
				#Advance to pop level 5
				if = { 
					limit = { 
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = temple
						}
						check_variable = { which = holding_pop value = 999.5 } 
					}
					remove_holding_modifier = arles_holding_pop4
					add_holding_modifier = { modifier = arles_holding_pop5 duration = -1 }
					set_title_flag = metropolitan
					log = "DEBUG arles_base.4 Changed civ holding modifier to Level 5 based on holding population of [This.holding_pop.GetValue]"
				}
				log = "DEBUG arles_base.4 Reached end of holding population calculations"
			}
		}
		repeat_event = { id = arles_base.4 }
		log = "DEBUG arles_base.4 Initiated recursion"
	}
}

#arles_base.5
#Finishing up province setup
character_event = {
	id = arles_base.5
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_demesne_province = {
			NOT = { has_province_flag = dixitquedeus }
		}
	}
	
	immediate = {
		random_list = { #Advance random seed
			50 = { if = { limit = { always = yes } } } #Fool the engine
			50 = { }
		}
	}
	
	option = {
		name = "OK"
		event_target:home_province = {
			if = {
				limit = { NOT = { has_province_flag = dixitquedeus } }
				set_province_flag = dixitquedeus
				log = "DEBUG: arles_base.5 Beginning processing of [This.GetName], Province [This.GetID]"
			
				#BEGIN TERRAIN POP GROWTH CONSTANTS
				if = {
					limit = { terrain = mountain } #50% slower base pop growth in mountains
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.5 }
				}
				if = {
					limit = { terrain = hills } #25% slower base pop growth in hills
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.25 }
				}
				if = {
					limit = { terrain = forest } #20% slower base pop growth in forests
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.20 }
				}
				if = {
					limit = { terrain = plains } #Standard of growth
					set_variable = { which = province_pop_diff_terr value = 1 }
				}
				if = {
					limit = { terrain = farmlands } #5% faster base pop growth in farmland
					set_variable = { which = province_pop_diff_terr value = 1 }
					multiply_variable = { which = province_pop_diff_terr value = 1.05 }
				}
				if = {
					limit = { terrain = steppe } #20% slower base pop growth in steppes, not as much arable land
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.20 }
				}
				if = {
					limit = { terrain = desert } #35% slower base pop growth in desert
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.35 }
				}
				if = { 
					limit = { terrain = coastal_desert } #25% slower base pop growth in desert
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.25 }
				}
				if = {
					limit = { terrain = arctic } #50% slower base pop growth in arctic
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.5 }
				}
				if = {
					limit = { terrain = jungle } #35% slower base pop growth in jungle
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.35 }
				}
				if = {
					limit = { terrain = marsh } #25% slower base pop growth in marshland
					set_variable = { which = province_pop_diff_terr value = 1 }
					divide_variable = { which = province_pop_diff_terr value = 1.25 }
				}
				log = "DEBUG arles_base.5 Report province population as [This.province_pop.GetValue] before applying terrain modifier"
				
				#POPULATION - TERRAIN MODIFIERS (SUMMED SUCH THAT A FULLY UPGRADED 7-HOLDING PLAINS PROVINCE HAS EXACTLY 100 POP POINTS)
				multiply_variable = { which = province_pop which = province_pop_diff_terr }
				log = "DEBUG arles_base.5 Readjusted province using terrain modifier of [This.province_pop_diff_terr.GetValue] to [This.province_pop.GetValue]"
				
					
				#POPULATION - GOVERNMENT MODIFIERS
				if = { #Reduce province pop by 25% if subordinate to tribal
					limit = {
						holder_scope = { government = tribal_government }
					}
					multiply_variable = { which = province_pop value = 0.75 }
					log = "DEBUG arles_base.5 Readjusted province population to [This.province_pop.GetValue] due to tribal overlord"
				}
				if = { #Reduce province pop by 50% if subordinate to nomads
					limit = {
						holder_scope = { government = nomadic_government }
					}
					multiply_variable = { which = province_pop value = 0.5 }
					log = "DEBUG arles_base.5 Readjusted province population to [This.province_pop.GetValue] due to nomad overlord"
				}
				if = { #Reduce province pop by 100% if only nomads
					limit = {
						holder_scope = { government = nomadic_government }
						NOT = { any_province_holding = { NOT = { holding_type = nomad } } }
					}
					set_variable = { which = province_pop value = 0 }
					log = "DEBUG arles_base.5 Zeroed out province population to [This.province_pop.GetValue] due to nomad overlord of empty province"
				}
				
				#BEGIN POPULATION LEVEL ASSIGNMENT
				if = { #Advance to pop level 2
					limit = { 
						check_variable = { which = province_pop value = 4.5 }
						NOT = { has_province_flag = minor_pop }
					}
					remove_province_modifier = arles_pop1
					add_province_modifier = { name = arles_pop2 duration = -1 }
					set_province_flag = minor_pop
					log = "DEBUG arles_base.5 Changed province modifier to Level 2 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 3
					limit = { 
						check_variable = { which = province_pop value = 19.5 } 
						NOT = { has_province_flag = burg_pop }
					}
					remove_province_modifier = arles_pop2
					add_province_modifier = { name = arles_pop3 duration = -1 }
					set_province_flag = burg_pop
					log = "DEBUG arles_base.5 Changed province modifier to Level 3 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 4
					limit = { 
						check_variable = { which = province_pop value = 34.5 } 
						NOT = { has_province_flag = burg_pop }
					}
					remove_province_modifier = arles_pop3
					add_province_modifier = { name = arles_pop4 duration = -1 }
					set_province_flag = major_pop
					log = "DEBUG arles_base.5 Changed province modifier to Level 4 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 5
					limit = { 
						check_variable = { which = province_pop value = 49.5 } 
						NOT = { has_province_flag = metropolitan }
					}
					remove_province_modifier = arles_pop4
					add_province_modifier = { name = arles_pop5 duration = -1 }
					set_province_flag = metropolitan
					log = "DEBUG arles_base.5 Changed province modifier to Level 5 based on holding population of [This.province_pop.GetValue]"
				}
					
				#BEGIN SEED RESOURCES
				if = {
					limit = { 
						OR = {
							port = yes
							borders_lake = yes
						}
					}
					random = {
						chance = 33
						add_province_modifier = { name = arles_fishing duration = -1 }
						log = "DEBUG arles_base.5 Added Fish to province"
					}
				}
				if = {
					limit = { terrain = arctic } #Furs and Game
					random = {
						chance = 33
						add_province_modifier = { name = arles_furs duration = -1 }
						log = "DEBUG arles_base.5 Added Furs to province"
					}
					random = {
						chance = 25
						add_province_modifier = { name = arles_game duration = -1 }
						log = "DEBUG arles_base.5 Added Game to province"
					}
				}
				if = {
					limit = { terrain = mountain } #Silver, Stone, and Minerals
					random = {
						chance = 15
						add_province_modifier = { name = arles_silver duration = -1 }
						log = "DEBUG arles_base.5 Added Silver to province"
					}
					random = {
						chance = 33
						add_province_modifier = { name = arles_stone duration = -1 }
						log = "DEBUG arles_base.5 Added Stone to province"
					}
					random = {
						chance = 33
						add_province_modifier = { name = arles_minerals duration = -1 }
						log = "DEBUG arles_base.5 Added Minerals to province"
					}
				}
				if = {
					limit = { terrain = hills } #Silver, Stone, and Minerals
					random = {
						chance = 10
						add_province_modifier = { name = arles_silver duration = -1 }
						log = "DEBUG arles_base.5 Added Silver to province"
					}
					random = {
						chance = 33 
						add_province_modifier = { name = arles_stone duration = -1 }
						log = "DEBUG arles_base.5 Added Stone to province"
					}
					random = {
						chance = 33
						add_province_modifier = { name = arles_minerals duration = -1 }
						log = "DEBUG arles_base.5 Added Minerals to province"
					}
					random = {
						chance = 5
						set_province_flag = undiscovered_gems
						log = "DEBUG arles_base.5 Added Undiscovered Gems to province"
					}
				}
				if = {
					limit = { terrain = forest } #Game and Minerals
					random = {
						chance = 33
						add_province_modifier = { name = arles_game duration = -1 }
						log = "DEBUG arles_base.5 Added Game to province"
					}
					random = {
						chance = 15
						add_province_modifier = { name = arles_minerals duration = -1 }
						log = "DEBUG arles_base.5 Added Minerals to province"
					}
				}
				if = {
					limit = { terrain = farmlands } #Fertile Soil and Pastureland
					random = {
						chance = 75
						add_province_modifier = { name = arles_fertile duration = -1 }
						log = "DEBUG arles_base.5 Added Farmland to province"
					}
					random = {
						chance = 75	
						add_province_modifier = { name = arles_pasture duration = -1 }
						log = "DEBUG arles_base.5 Added Pasture to province"
					}
				}
				if = {
					limit = { terrain = plains } #Fertile Soil and Pastureland
					random = {
						chance = 33
						add_province_modifier = { name = arles_pasture duration = -1 }
						log = "DEBUG arles_base.5 Added Pasture to province"
					}
					random = {
						chance = 25
						add_province_modifier = { name = arles_fertile duration = -1 }
						log = "DEBUG arles_base.5 Added Farmland to province"
					}
					if = { #Silver or Minerals from the rivers
						limit = { borders_major_river = yes }
						random = {
							chance = 5
							add_province_modifier = { name = arles_silver duration = -1 }
							log = "DEBUG arles_base.5 Added Silver to province"
						}
						random = {
							chance = 20.5
							add_province_modifier = { name = arles_minerals duration = -1 }
							log = "DEBUG arles_base.5 Added Minerals to province"
						}
					}
				}
				if = {
					limit = { terrain = steppe } #Pastureland
					random = {
						chance = 40
						add_province_modifier = { name = arles_pasture duration = -1 }
						log = "DEBUG arles_base.5 Added Pasture to province"
					}
				}
				if = {
					limit = { province_id = 371 } #Sambia
					event_target:verbum = {
						change_variable = { which = amber_gaia value = 1 }
					}
					add_province_modifier = { name = arles_amber duration = -1 }
					log = "DEBUG arles_base.5 Added Amber to province"
				}
				if = {
					limit = { 
						event_target:verbum = {
							NOT = { check_variable = { which = "amber_gaia" value = 1.5 } }
						}
						region = custom_eastern_baltic 
					}
					event_target:verbum = {
						change_variable = { which = amber_gaia value = 1 }
					}
					add_province_modifier = { name = arles_amber duration = -1 }
					log = "DEBUG arles_base.5 Added Amber to province"
				}
				if = {
					limit = { 
						province_id = 925 #Mali
					}
					add_province_modifier = { name = arles_gold duration = -1 }
					log = "DEBUG arles_base.5 Added Gold to province"
				}
				if = {
					limit = { 
						province_id = 911 #Timbuktu
					}
					add_province_modifier = { name = arles_gold duration = -1 }
					log = "DEBUG arles_base.5 Added Gold to province"
				}
				if = {
					limit = {
						event_target:verbum = {
							NOT = { check_variable = { which = "gold_gaia" value = 0.5 } }
						}
						de_jure_liege_or_above = k_nubia #Gold for the Baqt
					}
					event_target:verbum = {
						change_variable = { which = gold_gaia value = 1 }
					}
					add_province_modifier = { name = arles_gold duration = -1 }
					log = "DEBUG arles_base.5 Added Gold to province"
				}
				if = {
					limit = { #3 random sources of Ivory
						event_target:verbum = {
							NOT = { check_variable = { which = "ivory_gaia" value = 2.5 } }
						}
						OR = {
							region = world_africa_east
							region = world_africa_west
						}
						OR = {
							terrain = desert 
							terrain = plains
						}
					}
					event_target:verbum = {
						change_variable = { which = ivory_gaia value = 1 }
					}
					add_province_modifier = { name = arles_ivory duration = -1 }
					log = "DEBUG arles_base.5 Added Ivory to province"
				}
				if = {
					limit = {
						province_id = 448 #Salzburg
					}
					add_province_modifier = { name = arles_salt duration = -1 }
					log = "DEBUG arles_base.5 Added Salt to province"
				}
				if = {
					limit = {
						province_id = 515 #Tirgoviste
					}
					add_province_modifier = { name = arles_salt duration = -1 }
					log = "DEBUG arles_base.5 Added Salt to province"
				}
				if = {
					limit = {
						province_id = 916 #Taghaza
					}
					add_province_modifier = { name = arles_salt duration = -1 }
					log = "DEBUG arles_base.5 Added Salt to province"
				}
				if = {
					limit = {
						province_id = 527 #Krakow
					}
					add_province_modifier = { name = arles_salt duration = -1 }
					log = "DEBUG arles_base.5 Added Salt to province"
				}
			}
		}	
	}
}

#Base event for holding pop growth
character_event = {
	id = arles_base.6
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		event_target:home_holding = {
			location = { NOT = { has_province_modifier = arles_popgrowth } }
		}
	}
	
	option = {
		event_target:home_holding = {
			location = {
				any_province_holding = {
					set_variable = { which = holding_pop_diff value = 1 } #reset from previous to default
				
					#BEGIN TERRAIN MODIFIERS
					multiply_variable = { which = holding_pop_diff which = holding_pop_diff_terr }
					log = "DEBUG arles_base.6 Successfully applied terrain modifiers to holding population diff at [This.holding_pop_diff.GetValue]"
					
					#BEGIN TRADE MODIFIERS
					
					#SUM TRADE MODIFIERS HERE
					#log = "DEBUG arles_base.4 Successfully summed trade modifiers at [This.holding_pop_trade.GetValue]"
					change_variable = { which = holding_pop_diff which = holding_pop_diff_trade }
					log = "DEBUG arles_base.6 Successfully applied trade modifiers to holding population diff at [This.holding_pop_diff.GetValue]"
					
					#SUM DIFF WITH HOLDING POPULATION
					change_variable = { which = holding_pop which = holding_pop_diff }
					log = "DEBUG arles_base.6 Successfully summed holding pop diff to holding population of [This.GetName] ([This.GetID]) at [This.holding_pop_diff.GetValue]"
					
					#BEGIN POPULATION LEVEL ASSIGNMENT
					if = {
						limit = {
							check_variable = { which = holding_pop value = 74.5 } 
							NOT = { has_title_flag = clan_pop }
						}
						add_building = tb_market_town_2
						log = "DEBUG arles_base.6 Successfully built new housing in tribal village"
						set_title_flag = clan_pop
						location = {
							set_variable = { which = province_pop_diff value = 0 }
							change_variable = { which = province_pop_diff value = 0.75 }
							multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
							change_variable = { which = province_pop which = province_pop_diff }
							log = "DEBUG arles_base.6 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						}
					}
					if = { #Advance to pop level 2
						limit = { 
							check_variable = { which = holding_pop value = 149.5 } 
							NOT = { check_variable = { which = holding_pop value = 299.5 } }
							NOT = { has_title_flag = minor_pop }
						}
						remove_holding_modifier = arles_holding_pop1
						add_holding_modifier = { modifier = arles_holding_pop2 duration = -1 }
						if = {
							limit = { holding_type = castle }
							add_building = ca_town_2
							log = "DEBUG arles_base.6 Successfully built new housing in castle"
						}
						if = {
							limit = { holding_type = city }
							add_building = ct_marketplace_2
							log = "DEBUG arles_base.6 Successfully built new housing in city"
						}
						if = {
							limit = { holding_type = temple }
							add_building = tp_town_2
							log = "DEBUG arles_base.6 Successfully built new housing in temple"
						}
						if = {
							limit = { holding_type = tribal }
							add_building = tb_market_town_3
							log = "DEBUG arles_base.6 Successfully built new housing in tribal village"
						}
						set_title_flag = minor_pop
						log = "DEBUG arles_base.6 Changed holding modifier to Level 2 based on holding population of [This.holding_pop.GetValue]"
						location = {
							set_variable = { which = province_pop_diff value = 0 }
							change_variable = { which = province_pop_diff value = 1.25 }
							multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
							change_variable = { which = province_pop which = province_pop_diff }
							add_province_modifier = { name = arles_popgrowth days = 365 }
							log = "DEBUG arles_base.6 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						}
					}
					if = { #Advance to pop level 3
						limit = { 
							check_variable = { which = holding_pop value = 299.5 } 
							NOT = { check_variable = { which = holding_pop value = 499.5 } }
							NOT = { has_title_flag = burg_pop }
						}
						remove_holding_modifier = arles_holding_pop2
						add_holding_modifier = { modifier = arles_holding_pop3 duration = -1 }
						if = {
							limit = { holding_type = castle }
							add_building = ca_town_3
							log = "DEBUG arles_base.6 Successfully built new housing in castle"
						}
						if = {
							limit = { holding_type = city }
							add_building = ct_marketplace_3
							log = "DEBUG arles_base.6 Successfully built new housing in city"
						}
						if = {
							limit = { holding_type = temple }
							add_building = tp_town_3
							log = "DEBUG arles_base.6 Successfully built new housing in temple"
						}
						if = {
							limit = { holding_type = tribal }
							add_building = tb_market_town_4
							log = "DEBUG arles_base.6 Successfully built new housing in tribal village"
						}
						set_title_flag = burg_pop
						log = "DEBUG arles_base.6 Changed holding modifier to Level 3 based on holding population of [This.holding_pop.GetValue]"
						location = {
							set_variable = { which = province_pop_diff value = 0 }
							change_variable = { which = province_pop_diff value = 1.75 }
							multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
							change_variable = { which = province_pop which = province_pop_diff }
							add_province_modifier = { name = arles_popgrowth days = 365 }
							log = "DEBUG arles_base.6 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						}
					}
					if = { #Advance to pop level 4
						limit = { 
							check_variable = { which = holding_pop value = 499.5 } 
							NOT = { check_variable = { which = holding_pop value = 999.5 } }
							NOT = { has_title_flag = major_pop }
						}
						remove_holding_modifier = arles_holding_pop3
						if = {
							limit = { holding_type = castle }
							add_building = ca_town_4
							add_holding_modifier = { modifier = arles_holding_pop4 duration = -1 }
							log = "DEBUG arles_base.6 Successfully built new housing in castle"
						}
						if = {
							limit = { holding_type = city }
							add_building = ct_marketplace_4
							add_holding_modifier = { modifier = arles_holding_pop4 duration = -1 }
							log = "DEBUG arles_base.6 Successfully built new housing in city"
						}
						if = {
							limit = { holding_type = temple }
							add_building = tp_town_4
							add_holding_modifier = { modifier = arles_holding_pop4 duration = -1 }
							log = "DEBUG arles_base.6 Successfully built new housing in temple"
						}
						set_title_flag = major_pop
						log = "DEBUG arles_base.6 Changed holding modifier to Level 4 based on holding population of [This.holding_pop.GetValue]"
						location = {
							set_variable = { which = province_pop_diff value = 0 }
							change_variable = { which = province_pop_diff value = 2.25 }
							multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
							change_variable = { which = province_pop which = province_pop_diff }
							add_province_modifier = { name = arles_popgrowth days = 365 }
							log = "DEBUG arles_base.6 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						}
					}
					if = { #Advance to pop level 5
						limit = { 
							check_variable = { which = holding_pop value = 999.5 } 
							NOT = { has_title_flag = metropolitan }
						}
						remove_holding_modifier = arles_holding_pop4
						add_holding_modifier = { modifier = arles_holding_pop5 duration = -1 }
						if = {
							limit = { holding_type = castle }
							add_building = ca_town_5
							log = "DEBUG arles_base.6 Successfully built new housing in castle"
						}
						if = {
							limit = { holding_type = city }
							add_building = ct_marketplace_5
							log = "DEBUG arles_base.6 Successfully built new housing in city"
						}
						if = {
							limit = { holding_type = temple }
							add_building = tp_town_5
							log = "DEBUG arles_base.6 Successfully built new housing in temple"
						}
						set_title_flag = metropolitan
						log = "DEBUG arles_base.6 Changed holding modifier to Level 5 based on holding population of [This.holding_pop.GetValue]"
						location = {
							set_variable = { which = province_pop_diff value = 0 }
							change_variable = { which = province_pop_diff value = 2.75 }
							multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
							change_variable = { which = province_pop which = province_pop_diff }
							add_province_modifier = { name = arles_popgrowth days = 365 }
							log = "DEBUG arles_base.6 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						}
					}
					log = "DEBUG arles_base.6 Reached end of holding population calculations"
				}
				#BEGIN POPULATION LEVEL ASSIGNMENT
				if = { #Advance to pop level 2
					limit = { 
						check_variable = { which = province_pop value = 4.5 } 
						NOT = { has_province_flag = minor_pop }
					}
					remove_province_modifier = arles_pop1
					add_province_modifier = { name = arles_pop2 duration = -1 }
					set_province_flag = minor_pop
					log = "DEBUG arles_base.6 Changed province modifier to Level 2 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 3
					limit = { 
						check_variable = { which = province_pop value = 19.5 } 
						NOT = { has_province_flag = burg_pop }
					}
					remove_province_modifier = arles_pop2
					add_province_modifier = { name = arles_pop3 duration = -1 }
					set_province_flag = burg_pop
					log = "DEBUG arles_base.6 Changed province modifier to Level 3 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 4
					limit = {
						check_variable = { which = province_pop value = 34.5 } 
						NOT = { has_province_flag = major_pop }
					}
					remove_province_modifier = arles_pop3
					add_province_modifier = { name = arles_pop4 duration = -1 }
					set_province_flag = major_pop
					log = "DEBUG arles_base.6 Changed province modifier to Level 4 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 5
					limit = { 
						check_variable = { which = province_pop value = 49.5 } 
						NOT = { has_province_flag = metropolitan }
					}
					remove_province_modifier = arles_pop4
					add_province_modifier = { name = arles_pop5 duration = -1 }
					set_province_flag = metropolitan
					log = "DEBUG arles_base.6 Changed province modifier to Level 5 based on holding population of [This.province_pop.GetValue]"
				}
			}
		}
		character_event = { id = arles_base.6 days = 365 } #Recurse
	}
}

#Fired from on_settlement_construction_completed to seed new settlements
#arles_base.7
character_event = {
	id = arles_base.7
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			NOT = { has_title_flag = holding_has_pop }
			NOT = { holding_type = nomad }
		}
	}
	
	option = {
		name = "OK"
		FROM = {
			add_holding_modifier = { modifier = arles_holding_pop1 duration = -1 }
			set_variable = { which = holding_pop value = 0 }
			set_variable = { which = holding_pop_diff value = 0 }
			set_variable = { which = holding_pop_diff_terr value = 0 }
			set_variable = { which = holding_pop_diff_trade value = 0 }
			set_variable = { which = holding_pop_dmg value = 0 }
			set_title_flag = holding_has_pop
			log = "DEBUG: arles.base.7 Set up holding defines for new settlement at [This.GetName] ([This.GetID])"
				
			#BEGIN ADDING PRIMARY POPS
			if = {
				limit = { 
					NOT = {
						has_building = ca_town_1
						has_building = ct_marketplace_1
						has_building = tp_town_1
						has_building = tb_market_town_1
					}
				}
				if = {
					limit = { holding_type = castle }
					add_building = ca_town_1
					change_variable = { which = holding_pop value = 50 }
					log = "DEBUG arles_base.7 Added initial holding pop of [This.holding_pop.GetValue] to [This.GetName] ([This.GetID])"
					location = {
						change_variable = { which = province_pop_diff value = 1.25 }
						multiply_variable = { which = province_pop_diff which = province_pop_diff_terr }
						change_variable = { which = province_pop which = province_pop_diff }
						log = "DEBUG arles_base.7 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						set_variable = { which = province_pop_diff value = 0 }
					}
					log = "DEBUG arles_base.7 Successfully built new housing in castle"
				}
				if = {
					limit = { holding_type = city }
					add_building = ct_marketplace_1
					change_variable = { which = holding_pop value = 50 }
					log = "DEBUG arles_base.7 Added initial holding pop of [This.holding_pop.GetValue] to [This.GetName] ([This.GetID])"
					location = {
						change_variable = { which = province_pop_diff value = 1.25 }
						multiply_variable = { which = province_pop_diff which = province_pop_diff_terr }
						change_variable = { which = province_pop which = province_pop_diff }
						log = "DEBUG arles_base.7 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						set_variable = { which = province_pop_diff value = 0 }
					}
					log = "DEBUG arles_base.7 Successfully built new housing in city"
				}
				if = {
					limit = { holding_type = temple }
					add_building = tp_town_1
					change_variable = { which = holding_pop value = 50 }
					log = "DEBUG arles_base.7 Added initial holding pop of [This.holding_pop.GetValue] to [This.GetName] ([This.GetID])"
					location = {
						change_variable = { which = province_pop_diff value = 1.25 }
						multiply_variable = { which = province_pop_diff which = province_pop_diff_terr }
						change_variable = { which = province_pop which = province_pop_diff }
						log = "DEBUG arles_base.7 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						set_variable = { which = province_pop_diff value = 0 }
					}
					log = "DEBUG arles_base.7 Successfully built new housing in temple"
				}
				if = {
					limit = { holding_type = tribal }
					add_building = tb_market_town_1
					change_variable = { which = holding_pop value = 25 }
					log = "DEBUG arles_base.7 Added initial holding pop of [This.holding_pop.GetValue] to [This.GetName] ([This.GetID])"
					location = {
						change_variable = { which = province_pop_diff value = 0.75 }
						multiply_variable = { which = province_pop_diff which = province_pop_diff_terr }
						change_variable = { which = province_pop which = province_pop_diff }
						log = "DEBUG arles_base.7 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
						set_variable = { which = province_pop_diff value = 0 }
					}
					log = "DEBUG arles_base.7 Successfully built new housing in tribal village"
				}
			}
			location = {
				#BEGIN POPULATION LEVEL ASSIGNMENT
				if = { #Advance to pop level 2
					limit = { check_variable = { which = province_pop value = 4.5 } }
					remove_province_modifier = arles_pop1
					add_province_modifier = { name = arles_pop2 duration = -1 }
					log = "DEBUG arles_base.5 Changed province modifier to Level 2 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 3
					limit = { check_variable = { which = province_pop value = 19.5 } }
					remove_province_modifier = arles_pop2
					add_province_modifier = { name = arles_pop3 duration = -1 }
					log = "DEBUG arles_base.5 Changed province modifier to Level 3 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 4
					limit = { check_variable = { which = province_pop value = 34.5 } }
					remove_province_modifier = arles_pop3
					add_province_modifier = { name = arles_pop4 duration = -1 }
					log = "DEBUG arles_base.5 Changed province modifier to Level 4 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Advance to pop level 5
					limit = { check_variable = { which = province_pop value = 49.5 } }
					remove_province_modifier = arles_pop4
					add_province_modifier = { name = arles_pop5 duration = -1 }
					log = "DEBUG arles_base.5 Changed province modifier to Level 5 based on holding population of [This.province_pop.GetValue]"
				}
			}
		}
	}
}

character_event = {
	id = arles_base.8
	desc = arles_base.8_desc
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			holder_scope = { war_with = ROOT } #Besieger will not sack unless at war
		}
		NOT = { is_looting = yes }
	}
	
	option = {
		name = "arles_base.8.opt.a" 
		FROM = {
			if = {
				limit = { 
					has_building = tb_market_town_1 
					NOT = { has_building = tb_market_town_2 }
				} 
				set_variable = { which = holding_pop_dmg value = 0.85 } #15% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 2.5 }
			}
			if = {
				limit = {
					OR = {
						AND = {
							has_building = ca_town_1
							NOT = { has_building = ca_town_2 }
						}
						AND = {
							has_building = ct_marketplace_1
							NOT = { has_building = ct_marketplace_2 }
						}
						AND = {
							has_building = tp_town_1
							NOT = { has_building = tp_town_2 }
						}
						AND = {
							has_building = tb_market_town_2
							NOT = { has_building = tb_market_town_3 }
						}
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.90 } #10% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 5 }
			}
			if = {
				limit = {
					OR = {
						AND = {
							has_building = ca_town_2
							NOT = { has_building = ca_town_3 }
						}
						AND = {
							has_building = ct_marketplace_2
							NOT = { has_building = ct_marketplace_3 }
						}
						AND = {
							has_building = tp_town_2
							NOT = { has_building = tp_town_3 }
						}
						AND = {
							has_building = tb_market_town_3
							NOT = { has_building = tb_market_town_4 }
						}
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.90 } #10% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 10 }
			}
			if = {
				limit = {
					OR = {
						AND = {
							has_building = ca_town_3
							NOT = { has_building = ca_town_4 }
						}
						AND = {
							has_building = ct_marketplace_3
							NOT = { has_building = ct_marketplace_4 }
						}
						AND = {
							has_building = tp_town_3
							NOT = { has_building = tp_town_4 }
						}
						has_building = tb_market_town_4	
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.925 } #7.5% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 15 }
			}
			if = {
				limit = {
					OR = {
						has_building = ca_town_4
						has_building = ct_marketplace_4
						has_building = tp_town_4
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.925 } #7.5% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 20 }
			}
			if = {
				limit = {
					OR = {
						has_building = ca_town_5
						AND = {
							has_building = ct_marketplace_5
							NOT = { has_building = ct_marketplace_6 }
						}
						AND = {
							has_building = tp_town_5
							NOT = { has_building = tp_town_6 }
						}	
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.925 } #7.5% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 25 }
			}
			if = {
				limit = {
					OR = {
						has_building = ct_marketplace_6
						has_building = tp_town_6
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.95 } #5% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 30 }
			}			
			add_holding_modifier = { modifier = arles_victa years = 1 }
			
			#BEGIN HOLDING LEVEL ASSIGNMENT
			if = { #Devolve to tribal pop level 1
				limit = {
					NOT = { check_variable = { which = holding_pop value = 74.5 } }
					has_title_flag = clan_pop
					holding_type = tribal
				}
				remove_building = tb_market_town_2
				log = "DEBUG arles_base.8 Tribal level 2 housing destroyed in [This.GetName] ([This.GetID])"
				clr_title_flag = clan_pop
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 0.75 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			if = { #Devolve to pop level 1
				limit = { 
					NOT = { check_variable = { which = holding_pop value = 149.5 } }
					has_title_flag = minor_pop
				}
				remove_holding_modifier = arles_holding_pop2
				add_holding_modifier = { modifier = arles_holding_pop1 duration = -1 }
				if = {
					limit = { holding_type = castle }
					remove_building = ca_town_2
					log = "DEBUG arles_base.8 Level 2 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = city }
					remove_building = ct_marketplace_2
					log = "DEBUG arles_base.8 Level 2 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = temple }
					remove_building = tp_town_2
					log = "DEBUG arles_base.8 Level 2 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = tribal }
					remove_building = tb_market_town_3
					log = "DEBUG arles_base.6 Level 2 housing destroyed in [This.GetName] ([This.GetID])"
				}
				clr_title_flag = minor_pop
				log = "DEBUG arles_base.8 Devolved holding modifier to Level 1 based on holding population of [This.holding_pop.GetValue]"
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 1.25 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			if = { #Devolve to pop level 2
				limit = { 
					check_variable = { which = holding_pop value = 149.5 } 
					NOT = { check_variable = { which = holding_pop value = 299.5 } }
					has_title_flag = burg_pop
				}
				remove_holding_modifier = arles_holding_pop3
				add_holding_modifier = { modifier = arles_holding_pop2 duration = -1 }
				if = {
					limit = { holding_type = castle }
					remove_building = ca_town_3
					log = "DEBUG arles_base.8 Level 3 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = city }
					remove_building = ct_marketplace_3
					log = "DEBUG arles_base.8 Level 3 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = temple }
					remove_building = tp_town_3
					log = "DEBUG arles_base.8 Level 3 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = tribal }
					remove_building = tb_market_town_4
					log = "DEBUG arles_base.8 Level 3 housing destroyed in [This.GetName] ([This.GetID])"
				}
				clr_title_flag = burg_pop
				log = "DEBUG arles_base.8 Devolved holding modifier to Level 2 based on holding population of [This.holding_pop.GetValue]"
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 1.75 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			if = { #Devolve to pop level 3
				limit = { 
					check_variable = { which = holding_pop value = 299.5 } 
					NOT = { check_variable = { which = holding_pop value = 499.5 } }
					has_title_flag = major_pop
				}
				add_holding_modifier = { modifier = arles_holding_pop3 duration = -1 }
				if = {
					limit = { holding_type = castle }
					remove_building = ca_town_4
					remove_holding_modifier = arles_holding_pop4
					log = "DEBUG arles_base.8 Level 4 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = city }
					remove_building = ct_marketplace_4
					remove_holding_modifier = arles_holding_pop4
					log = "DEBUG arles_base.8 Level 4 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = temple }
					remove_building = tp_town_4
					remove_holding_modifier = arles_holding_pop4
					log = "DEBUG arles_base.8 Level 4 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = tribal }
					remove_building = tb_market_town_4
					remove_holding_modifier = arles_holding_pop4_tribal
					log = "DEBUG arles_base.8 Level 4 housing destroyed in [This.GetName] ([This.GetID])"
				}
				clr_title_flag = major_pop
				log = "DEBUG arles_base.8 Changed holding modifier to Level 4 based on holding population of [This.holding_pop.GetValue]"
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 2.25 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			if = { #Devolve to pop level 4
				limit = { 
					check_variable = { which = holding_pop value = 499.5 } 
					NOT = { check_variable = { which = holding_pop value = 999.5 } }
					has_title_flag = metropolitan
				}
				remove_holding_modifier = arles_holding_pop5
				add_holding_modifier = { modifier = arles_holding_pop4 duration = -1 }
				if = {
					limit = { holding_type = castle }
					remove_building = ca_town_5
					log = "DEBUG arles_base.8 Level 5 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = city }
					remove_building = ct_marketplace_5
					log = "DEBUG arles_base.8 Level 5 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = temple }
					remove_building = tp_town_5
					log = "DEBUG arles_base.8 Level 5 housing destroyed in [This.GetName] ([This.GetID])"
				}
				clr_title_flag = metropolitan
				log = "DEBUG arles_base.8 Devolved holding modifier to Level 5 based on holding population of [This.holding_pop.GetValue]"
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 2.75 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			log = "DEBUG arles_base.8 Reached end of holding population calculations"
			location = {	
				#BEGIN POPULATION LEVEL ASSIGNMENT
				if = { #Devolve to pop level 1
					limit = { 
						NOT = { check_variable = { which = province_pop value = 4.5 } }
						has_province_flag = minor_pop
					}
					remove_province_modifier = arles_pop2
					add_province_modifier = { name = arles_pop1 duration = -1 }
					clr_province_flag = minor_pop
					log = "DEBUG arles_base.8 Devolved province modifier to Level 1 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Devolve to pop level 2
					limit = { 
						check_variable = { which = province_pop value = 4.5 }
						NOT = { check_variable = { which = province_pop value = 19.5 } }
						has_province_flag = burg_pop
					}
					remove_province_modifier = arles_pop3
					add_province_modifier = { name = arles_pop2 duration = -1 }
					log = "DEBUG arles_base.8 Devolved province modifier to Level 2 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Devolve to pop level 3
					limit = { 
						check_variable = { which = province_pop value = 19.5 }
						NOT = { check_variable = { which = province_pop value = 34.5 } }
						has_province_flag = major_pop
					}
					remove_province_modifier = arles_pop4
					add_province_modifier = { name = arles_pop3 duration = -1 }
					log = "DEBUG arles_base.8 Devolved province modifier to Level 3 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Devolve to pop level 4
					limit = { 
						check_variable = { which = province_pop value = 34.5 }
						NOT = { check_variable = { which = province_pop value = 49.5 } }
						has_province_flag = metropolitan
					}
					remove_province_modifier = arles_pop5
					add_province_modifier = { name = arles_pop4 duration = -1 }
					log = "DEBUG arles_base.8 Devolved province modifier to Level 4 based on holding population of [This.province_pop.GetValue]"
				}
			}
		}
		if = {
			limit = { trait = kind }
			remove_trait = kind
		}
		if = {
			limit = { trait = just }
			remove_trait = just
		}
		#if = {
			#limit = { 
			#	religion_group = pagan_group
			#	NOT = { has_character_modifier = arles_victor_pagan }
			#}
			#add_character_modifier = { name = arles_victor_pagan duration = 365 }
		#}
		if = {
			limit = { 
				NOT = { 
					#religion_group = pagan_group
					has_character_modifier = arles_victor 
				}
			}
			add_character_modifier = { name = arles_victor duration = 365 }
		}
		log = "DEBUG arles_base.8 [This.GetTitledName] decided to sack [From.GetName], reducing [From.GetName]'s population to [From.holding_pop.GetValue]"
		ai_chance = {
			factor = 2
			modifier = { # Won't do it if good OR lawful
				factor = 0
				OR = {
					trait = kind
					trait = just
				}
			}
			modifier = { # More likely if mean
				factor = 2
				OR = {
					trait = cruel
					trait = impaler
				}
			}
			modifier = { # More likely if greedy
				factor = 2
				trait = greedy
			}
			modifier = { # More likely if religious enemies
				factor = 2
				FROM = {
					holder_scope = {
						NOT = { religion_group = ROOT }
					}
				}
				OR = {
					trait = zealous
					trait = crusader
					trait = mujahid
					trait = holy_warrior
				}
			}
			modifier = { #More likely if broke
				factor = 2
				NOT = { wealth = 10 }
			}
		}
	}
	
	option = {
		name = "arles_base.8.opt.b" 
		trigger = { 
			NOT = { has_character_modifier = arles_raptor }
		}
		FROM = {
			if = {
				limit = {
					has_building = tb_market_town_1
				}
				set_variable = { which = holding_pop_dmg value = 0.75 } #25% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 5 }
			}
			if = {
				limit = {
					OR = {
						has_building = ca_town_1
						has_building = ct_marketplace_1
						has_building = tp_town_1
						has_building = tb_market_town_2
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.80 } #20% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 10 }
			}
			if = {
				limit = {
					OR = {
						has_building = ca_town_2
						has_building = ct_marketplace_2
						has_building = tp_town_2
						has_building = tb_market_town_3
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.85 } #15% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 20 }
			}
			if = {
				limit = {
					OR = {
						has_building = ca_town_3
						has_building = ct_marketplace_3
						has_building = tp_town_3
						has_building = tb_market_town_4
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.85 } #15% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 30 }
			}
			if = {
				limit = {
					OR = {
						has_building = ca_town_4
						has_building = ct_marketplace_4
						has_building = tp_town_4
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.85 } #15% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 40 }
			}
			if = {
				limit = {
					OR = {
						has_building = ca_town_5
						has_building = ct_marketplace_5
						has_building = tp_town_5
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.90 } #10% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 50 }
			}
			if = {
				limit = {
					OR = {
						has_building = ct_marketplace_6
						has_building = tp_town_6
					}
				}
				set_variable = { which = holding_pop_dmg value = 0.90 } #10% population loss
				multiply_variable = { which = holding_pop which = holding_pop_dmg }
				PREV = { wealth = 60 }
			}			
			hidden_tooltip = { #alert owner of action
				holder_scope = { 
					if = {
						limit = { higher_real_tier_than = baron }
						character_event = { id = arles_base.9 } 
					}
				}
			}
			add_holding_modifier = { modifier = arles_rapta years = 2 }
			#BEGIN HOLDING LEVEL ASSIGNMENT
			if = {
				limit = {
					NOT = { check_variable = { which = holding_pop value = 74.5 } }
					has_title_flag = clan_pop
					holding_type = tribal
				}
				remove_building = tb_market_town_2
				log = "DEBUG arles_base.8 Tribal level 2 housing destroyed in [This.GetName] ([This.GetID])"
				clr_title_flag = clan_pop
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 0.75 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			if = { #Devolve to pop level 1
				limit = { 
					NOT = { check_variable = { which = holding_pop value = 149.5 } }
					has_title_flag = minor_pop
				}
				remove_holding_modifier = arles_holding_pop2
				add_holding_modifier = { modifier = arles_holding_pop1 duration = -1 }
				if = {
					limit = { holding_type = castle }
					remove_building = ca_town_2
					log = "DEBUG arles_base.8 Level 2 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = city }
					remove_building = ct_marketplace_2
					log = "DEBUG arles_base.8 Level 2 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = temple }
					remove_building = tp_town_2
					log = "DEBUG arles_base.8 Level 2 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = tribal }
					remove_building = tb_market_town_3
					log = "DEBUG arles_base.6 Level 2 housing destroyed in [This.GetName] ([This.GetID])"
				}
				clr_title_flag = minor_pop
				log = "DEBUG arles_base.8 Devolved holding modifier to Level 1 based on holding population of [This.holding_pop.GetValue]"
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 1.25 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			if = { #Devolve to pop level 2
				limit = { 
					check_variable = { which = holding_pop value = 149.5 } 
					NOT = { check_variable = { which = holding_pop value = 299.5 } }
					has_title_flag = burg_pop
				}
				remove_holding_modifier = arles_holding_pop3
				add_holding_modifier = { modifier = arles_holding_pop2 duration = -1 }
				if = {
					limit = { holding_type = castle }
					remove_building = ca_town_3
					log = "DEBUG arles_base.8 Level 3 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = city }
					remove_building = ct_marketplace_3
					log = "DEBUG arles_base.8 Level 3 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = temple }
					remove_building = tp_town_3
					log = "DEBUG arles_base.8 Level 3 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = tribal }
					remove_building = tb_market_town_4
					log = "DEBUG arles_base.8 Level 3 housing destroyed in [This.GetName] ([This.GetID])"
				}
				clr_title_flag = burg_pop
				log = "DEBUG arles_base.8 Devolved holding modifier to Level 2 based on holding population of [This.holding_pop.GetValue]"
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 1.75 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			if = { #Devolve to pop level 3
				limit = { 
					check_variable = { which = holding_pop value = 299.5 } 
					NOT = { check_variable = { which = holding_pop value = 499.5 } }
					has_title_flag = major_pop
				}
				add_holding_modifier = { modifier = arles_holding_pop3 duration = -1 }
				if = {
					limit = { holding_type = castle }
					remove_building = ca_town_4
					remove_holding_modifier = arles_holding_pop4
					log = "DEBUG arles_base.8 Level 4 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = city }
					remove_building = ct_marketplace_4
					remove_holding_modifier = arles_holding_pop4
					log = "DEBUG arles_base.8 Level 4 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = temple }
					remove_building = tp_town_4
					remove_holding_modifier = arles_holding_pop4
					log = "DEBUG arles_base.8 Level 4 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = tribal }
					remove_building = tb_market_town_4
					remove_holding_modifier = arles_holding_pop4_tribal
					log = "DEBUG arles_base.8 Level 4 housing destroyed in [This.GetName] ([This.GetID])"
				}
				clr_title_flag = major_pop
				log = "DEBUG arles_base.8 Changed holding modifier to Level 3 based on holding population of [This.holding_pop.GetValue]"
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 2.25 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			if = { #Devolve to pop level 4
				limit = { 
					check_variable = { which = holding_pop value = 499.5 } 
					NOT = { check_variable = { which = holding_pop value = 999.5 } }
					has_title_flag = metropolitan
				}
				remove_holding_modifier = arles_holding_pop5
				add_holding_modifier = { modifier = arles_holding_pop4 duration = -1 }
				if = {
					limit = { holding_type = castle }
					remove_building = ca_town_5
					log = "DEBUG arles_base.8 Level 5 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = city }
					remove_building = ct_marketplace_5
					log = "DEBUG arles_base.8 Level 5 housing destroyed in [This.GetName] ([This.GetID])"
				}
				if = {
					limit = { holding_type = temple }
					remove_building = tp_town_5
					log = "DEBUG arles_base.8 Level 5 housing destroyed in [This.GetName] ([This.GetID])"
				}
				clr_title_flag = metropolitan
				log = "DEBUG arles_base.8 Devolved holding modifier to Level 4 based on holding population of [This.holding_pop.GetValue]"
				location = {
					set_variable = { which = province_pop_diff value = 0 }
					subtract_variable = { which = province_pop_diff value = 2.75 }
					multiply_variable = { which = province_pop_diff_terr which = province_pop_diff }
					change_variable = { which = province_pop which = province_pop_diff }
					log = "DEBUG arles_base.8 Changed province pop in [This.GetName] ([This.GetID]) to [This.province_pop.GetValue] by [This.province_pop_diff.GetValue]"
				}
			}
			log = "DEBUG arles_base.8 Reached end of holding population calculations"
			location = {	
				#BEGIN POPULATION LEVEL ASSIGNMENT
				if = { #Devolve to pop level 1
					limit = { 
						NOT = { check_variable = { which = province_pop value = 4.5 } }
						has_province_flag = minor_pop
					}
					remove_province_modifier = arles_pop2
					add_province_modifier = { name = arles_pop1 duration = -1 }
					clr_province_flag = minor_pop
					log = "DEBUG arles_base.8 Devolved province modifier to Level 1 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Devolve to pop level 2
					limit = { 
						check_variable = { which = province_pop value = 4.5 }
						NOT = { check_variable = { which = province_pop value = 19.5 } }
						has_province_flag = burg_pop
					}
					remove_province_modifier = arles_pop3
					add_province_modifier = { name = arles_pop2 duration = -1 }
					log = "DEBUG arles_base.8 Devolved province modifier to Level 2 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Devolve to pop level 3
					limit = { 
						check_variable = { which = province_pop value = 19.5 }
						NOT = { check_variable = { which = province_pop value = 34.5 } }
						has_province_flag = major_pop
					}
					remove_province_modifier = arles_pop4
					add_province_modifier = { name = arles_pop3 duration = -1 }
					log = "DEBUG arles_base.8 Devolved province modifier to Level 3 based on holding population of [This.province_pop.GetValue]"
				}
				if = { #Devolve to pop level 4
					limit = { 
						check_variable = { which = province_pop value = 34.5 }
						NOT = { check_variable = { which = province_pop value = 49.5 } }
						has_province_flag = metropolitan
					}
					remove_province_modifier = arles_pop5
					add_province_modifier = { name = arles_pop4 duration = -1 }
					log = "DEBUG arles_base.8 Devolved province modifier to Level 4 based on holding population of [This.province_pop.GetValue]"
				}
			}
		}		
		if = {
			limit = { trait = kind }
			remove_trait = kind
		}
		if = {
			limit = { trait = just }
			remove_trait = just
		}
		if = {
			limit = { NOT = { trait = cruel } }
			add_trait = cruel
		}
		#if = {
		#	limit = { 
		#		religion_group = pagan_group
		#		NOT = { has_character_modifier = arles_raptor_pagan }
		#	}
		#	add_character_modifier = { name = arles_raptor_pagan duration = 365 }
		#}
		if = {
			limit = { 
				#NOT = { religion_group = pagan_group }
				NOT = { has_character_modifier = arles_raptor }
			}
			add_character_modifier = { name = arles_raptor duration = 730 }
		}
		log = "DEBUG arles_base.8 [This.GetTitledName] decided to pillage [From.GetName], reducing [From.GetName]'s population to [From.holding_pop.GetValue]"
		ai_chance = {
			factor = 1
			modifier = { # Won't do it if good OR lawful
				factor = 0
				OR = {
					trait = kind
					trait = just
				}
			}
			modifier = { # More likely if mean
				factor = 2
				OR = {
					trait = cruel
					trait = impaler
				}
			}
			modifier = { # More likely if religious enemies
				factor = 2
				FROM = {
					holder_scope = {
						NOT = { religion_group = ROOT }
					}
				}
				OR = {
					trait = zealous
					trait = crusader
					trait = mujahid
					trait = holy_warrior
				}
			}
			modifier = { #More likely if broke
				factor = 2
				NOT = { wealth = 10 }
			}
		}
	}
	option = {
		name = arles_base.8.opt.c
		log = "DEBUG arles_base.8 [This.GetTitledName] decided to leave [From.GetName] alone, keeping [From.GetName]'s population at [From.holding_pop.GetValue]"
		ai_chance = {
			factor = 1
			modifier = { #Good OR lawful
				factor = 2
				OR = {
					trait = kind
					trait = just
				}
			}
			modifier = { # Less likely if mean
				factor = 0.5
				OR = {
					trait = cruel
					trait = impaler
				}
			}
			modifier = { # Less likely if religious enemies
				factor = 0.5
				FROM = {
					holder_scope = {
						NOT = { religion_group = ROOT }
					}
				}
				OR = {
					trait = zealous
					trait = crusader
					trait = mujahid
					trait = holy_warrior
				}
			}
			modifier = { #Less likely if broke
				factor = 0.5
				NOT = { wealth = 10 }
			}
		}
	}
}

character_event = {
	id = arles_base.9
	desc = arles_base.9_desc
	picture = GFX_evt_siege
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				AND = {
					real_tier = count
					NOT = { demesne_size = 5 }
					FROM = { higher_real_tier_than = DUKE }
				}
				AND = {
					real_tier = count
					demesne_size = 5
					FROM = { higher_real_tier_than = KING }
				}
				tier = baron
			}
		}
					
		name = arles_base.9.opt.a
		add_rival = FROM
		prestige = -25
		log = "DEBUG arles_base.9 [This.GetTitledName] decided to rival [From.GetTitledName] for pillaging his city"
		ai_chance = {
			factor = 1
			modifier = { #Brave or Just
				factor = 0
				OR = {
					trait = brave
					trait = just
				}
			}
			modifier = { # Less likely if mean
				factor = 0.5
				OR = {
					trait = cruel
					trait = impaler
				}
			}
			modifier = { # More likely if religious enemies
				factor = 2
				FROM = {
					holder_scope = {
						NOT = { religion_group = ROOT }
					}
				}
				OR = {
					trait = zealous
					trait = crusader
					trait = mujahid
					trait = holy_warrior
				}
			}
			modifier = { #Less likely if broke
				factor = 0.5
				NOT = { wealth = 10 }
			}
		}
	}
	
	option = {
		name = arles_base.9.opt.b
		prestige = -50
		log = "DEBUG arles_base.9 [This.GetTitledName] decided not to take action against [From.GetTitledName] for pillaging his city"
		ai_chance = {
			factor = 1
			modifier = { #More likely if not brave or just
				factor = 0.5
				OR = {
					trait = brave
					trait = just
				}
			}
			modifier = { # More likely if mean
				factor = 2
				OR = {
					trait = cruel
					trait = impaler
					trait = arbitrary
				}
			}
			modifier = { # Less likely if religious enemies
				factor = 0.5
				FROM = {
					holder_scope = {
						NOT = { religion_group = ROOT }
					}
				}
				OR = {
					trait = zealous
					trait = crusader
					trait = mujahid
					trait = holy_warrior
				}
			}
			modifier = { #More likely if broke
				factor = 2
				NOT = { wealth = 10 }
			}
		}
	}
}